@page "/quiz/new"
@page "/quiz/{QuizId}/edit"
@using MediatR
@inject IMediator _mediator
@inject NavigationManager _navManager

<h3>@_title</h3>

<EditForm Model="@_command" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label class="form-label">Certification</label>
        <InputText id="certification" class="form-control" @bind-Value="_command.Certification" />
    </div>

    <div class="mb-3">
        <label class="form-label">Section</label>
        <InputText id="skill" class="form-control" @bind-Value="_command.Section" />
    </div>

    <div class="mb-3">
        <label class="form-label">Subsection</label>
        <InputText id="topic" class="form-control" @bind-Value="_command.Subsection" />
    </div>

    <div class="mb-3">
        <label class="form-label">Topic</label>
        <InputText id="title" class="form-control" @bind-Value="_command.Topic" />
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>

@code {
    [Parameter]
    public string QuizId { get; set; }

    private string _title = "Create Quiz";

    private QuizUpsert.Command _command = new QuizUpsert.Command();

    protected override async Task OnInitializedAsync()
    {
        if (QuizId != null)
        {
            _command = await _mediator.Send(new QuizUpsert.Query() {Id = QuizId});
            _title = "Edit Quiz";
        }
    }

    private async Task HandleValidSubmit()
    {
        await _mediator.Send(_command);
        _navManager.NavigateTo(_navManager.BaseUri);
    }

}